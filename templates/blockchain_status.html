<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blockchain Status — Secure File Storage</title>

  <style>
    :root{
      --bg:#0f172a; --bg-soft:#111827; --card:#0b1220; --surface:#0c1424;
      --text:#e5e7eb; --muted:#9ca3af; --primary:#6366f1; --primary-600:#5457ea;
      --accent:#22d3ee; --ring:#a5b4fc; --success:#22c55e; --warning:#f59e0b; --danger:#ef4444; --info:#3b82f6;
      --shadow: 0 16px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
      --radius: 16px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f6f7fb; --bg-soft:#eef1f6; --card:#ffffff; --surface:#ffffff;
        --text:#0f172a; --muted:#475569; --primary:#4f46e5; --primary-600:#4338ca;
        --accent:#06b6d4; --ring:#a5b4fc; --shadow:0 16px 40px rgba(2,6,23,.08);
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(99,102,241,.25), transparent 60%),
        radial-gradient(900px 500px at 110% 10%, rgba(34,211,238,.18), transparent 60%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg-soft) 100%);
      padding: 24px 0;
      min-height:100vh;
    }

    /* Top Nav Bar */
    .topbar{
      position: sticky; top: 0; z-index: 20;
      background: rgba(11,18,32,.85);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .topbar-inner{
      max-width: 1100px; margin: 0 auto; padding: 14px 18px;
      display:flex; align-items:center; justify-content:space-between; gap:14px;
    }
    .brand{
      font-weight: 800; letter-spacing:.2px;
      font-size: clamp(18px, 2.4vw, 20px);
    }
    .nav-links{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .nav-links a{
      text-decoration:none; color:white; font-weight:700;
      padding: 10px 14px; border-radius: 999px;
      background: var(--primary);
      border:1px solid transparent;
      box-shadow: 0 8px 20px rgba(99,102,241,.25);
      transition: transform .05s ease, background-color .12s ease;
    }
    
    .nav-links a:hover{ background: var(--primary-600); transform: translateY(-1px); }
    .nav-links a.logout{ background:#6c757d; }
    .nav-links a.logout:hover{ background:#545b62; }
    .nav-links a.active{ outline:2px solid var(--ring); }

    /* Page shell */
    .container{
      max-width: 1100px;
      margin: 16px auto 0;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.06);
      overflow: clip;
    }
    .header{
      padding: 26px;
      background:
        linear-gradient(135deg, rgba(99,102,241,.18), rgba(34,211,238,.12)),
        linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));
      text-align:center;
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .header h1{ margin:0 0 6px; font-size: clamp(22px, 3.2vw, 32px); font-weight:800; }
    .header p{ margin:0; color:var(--muted); }
    .contract-box{
      margin-top: 16px; padding: 14px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
      border-radius:12px; text-align:left;
    }
    .contract-box code{
      background:#0b1220; padding:2px 6px; border-radius:6px; border:1px solid rgba(255,255,255,.08);
    }
    .content{ padding: 26px; }

    /* Status grid */
    .status-grid{
      display:grid; grid-template-columns: repeat(auto-fit, minmax(260px,1fr));
      gap:16px; margin-bottom: 22px;
    }
    .status-card{
      background: var(--surface);
      border:1px solid rgba(255,255,255,.06);
      border-radius: 14px;
      padding: 16px;
      border-left: 5px solid var(--info);
    }
    .status-card.success{ border-left-color: var(--success); }
    .status-card.warning{ border-left-color: var(--warning); }
    .status-card.error{ border-left-color: var(--danger); }
    .status-title{ font-weight:800; margin:0 0 6px; color:#cbd5e1; }
    .status-value{ color:var(--muted); font-size:1.02rem; }
    .status-value.success{ color:#86efac; }
    .status-value.warning{ color:#fde68a; }
    .status-value.error{ color:#fecaca; }

    /* Blockchain info */
    .blockchain-info{
      background: var(--surface);
      border:1px solid rgba(255,255,255,.06);
      border-radius: 14px; padding: 16px; margin-bottom: 18px;
    }
    .info-item{
      display:flex; justify-content:space-between; gap:12px;
      padding:10px 0; border-bottom:1px solid rgba(255,255,255,.08);
    }
    .info-item:last-child{ border-bottom:none; }
    .info-label{ font-weight:800; color:#cbd5e1; }
    .info-value{ color:var(--muted); font-family: ui-monospace, Menlo, Consolas, monospace; }
    .info-value a{ color:#93c5fd; text-decoration:none; font-weight:700; }

    /* Alerts */
    .alert{
      padding: 14px; border-radius: 12px; margin-bottom: 18px;
      border:1px solid transparent; background: rgba(255,255,255,.03);
    }
    .alert-info{ border-color: rgba(59,130,246,.5); color:#bfdbfe; }
    .alert-warning{ border-color: rgba(245,158,11,.55); color:#fde68a; }
    .alert-danger{ border-color: rgba(239,68,68,.55); color:#fecaca; }

    /* Actions */
    .actions{ display:flex; gap:12px; flex-wrap:wrap; }
    .btn{
      padding: 12px 18px; border:none; border-radius:12px; font-weight:800; cursor:pointer; text-decoration:none;
      transition: transform .05s ease, background-color .12s ease, box-shadow .12s ease;
      background: var(--primary); color:white; box-shadow: 0 8px 20px rgba(99,102,241,.25);
    }
    .btn:hover{ background: var(--primary-600); transform: translateY(-1px); }
    .btn-warning{ background:#f59e0b; color:#0f172a; box-shadow:none; }
    .btn-warning:hover{ background:#d97706; }
    .btn-success{ background:#22c55e; }
    .btn-success:hover{ background:#16a34a; }

    @media (max-width: 720px){
      .topbar-inner{ padding:12px 14px; }
      .nav-links{ gap:8px; }
      .nav-links a{ padding:8px 12px; }
    }
    @media (prefers-reduced-motion: reduce){
      .nav-links a, .btn{ transition:none !important; }
    }
  </style>
</head>
<body>
  <!-- Top navigation bar -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">Secure File Storage</div>
      <nav class="nav-links" aria-label="Main">
        <a href="{{ url_for('index') }}">Dashboard</a>
        <a href="{{ url_for('list_files') }}">My Files</a>
        <a href="{{ url_for('get_public_key') }}">My Public Key</a>
        <a class="active" href="{{ url_for('blockchain_status') }}">Blockchain Status</a>
        <a href="{{ url_for('shared_files') }}">Shared Files</a>
        <a class="logout" href="{{ url_for('logout') }}">Logout</a>
      </nav>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <h1>Blockchain Status</h1>
      <p>Monitor your network connection and smart contract state</p>

      {% if status.contract_address %}
      <div class="contract-box">
        <h3 style="margin:0 0 8px;">Contract Information</h3>
        <p style="margin:4px 0;"><strong>Address:</strong> <code>{{ status.contract_address }}</code></p>
        <p style="margin:4px 0;"><strong>Etherscan:</strong>
          <a href="https://sepolia.etherscan.io/address/{{ status.contract_address }}" target="_blank" style="color:#c7d2fe; text-decoration:underline;">View Contract</a>
        </p>
      </div>
      {% endif %}
    </div>

    <div class="content">
      {% if status.error %}
      <div class="alert alert-danger">
        <strong>Error:</strong> {{ status.error }}
      </div>
      {% endif %}

      <div class="status-grid">
        <div class="status-card {% if status.available %}success{% else %}error{% endif %}">
          <div class="status-title">Blockchain Service</div>
          <div class="status-value {% if status.available %}success{% else %}error{% endif %}">
            {% if status.available %}✅ Available{% else %}❌ Not Available{% endif %}
          </div>
        </div>

        <div class="status-card {% if status.connected %}success{% else %}error{% endif %}">
          <div class="status-title">Network Connection</div>
          <div class="status-value {% if status.connected %}success{% else %}error{% endif %}">
            {% if status.connected %}✅ Connected{% else %}❌ Disconnected{% endif %}
          </div>
        </div>

        <div class="status-card {% if status.contract_deployed %}success{% else %}warning{% endif %}">
          <div class="status-title">Smart Contract</div>
          <div class="status-value {% if status.contract_deployed %}success{% else %}warning{% endif %}">
            {% if status.contract_deployed %}✅ Deployed{% else %}⚠️ Not Deployed{% endif %}
            {% if status.contract_address %}
              <br><small><a href="https://sepolia.etherscan.io/address/{{ status.contract_address }}" target="_blank" style="color:#93c5fd;">View on Etherscan</a></small>
            {% endif %}
          </div>
        </div>

        <div class="status-card {% if status.account_balance > 0.01 %}success{% elif status.account_balance > 0 %}warning{% else %}error{% endif %}">
          <div class="status-title">Account Balance</div>
          <div class="status-value {% if status.account_balance > 0.01 %}success{% elif status.account_balance > 0 %}warning{% else %}error{% endif %}">
            {{ "%.4f"|format(status.account_balance) }} ETH
          </div>
        </div>
      </div>

      {% if status.connected %}
      <div class="blockchain-info">
        <h3 style="margin:0 0 10px;">Blockchain Information</h3>

        <div class="info-item">
          <span class="info-label">Network:</span>
          <span class="info-value">Sepolia Testnet</span>
        </div>

        <div class="info-item">
          <span class="info-label">Chain ID:</span>
          <span class="info-value">{{ status.chain_id or 'N/A' }}</span>
        </div>

        {% if status.contract_address %}
        <div class="info-item">
          <span class="info-label">Contract Address:</span>
          <span class="info-value">
            <a href="https://sepolia.etherscan.io/address/{{ status.contract_address }}" target="_blank">
              {{ status.contract_address }}
            </a>
          </span>
        </div>
        {% endif %}

        <div class="info-item">
          <span class="info-label">Account Balance:</span>
          <span class="info-value">{{ "%.4f"|format(status.account_balance) }} ETH</span>
        </div>
      </div>
      {% endif %}

      {% if not status.available %}
      <div class="alert alert-warning">
        <strong>Blockchain Service Not Available</strong><br>
        Install dependencies:
        <pre style="margin:8px 0; background:#0b1220; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,.08); color:#d1d5db;">pip install web3 python-dotenv</pre>
      </div>
      {% elif not status.connected %}
      <div class="alert alert-danger">
        <strong>Cannot Connect to Blockchain</strong><br>
        Check your RPC URL and network config in <code>.env</code>.
      </div>
      {% elif not status.contract_deployed %}
      <div class="alert alert-warning">
        <strong>Smart Contract Not Deployed</strong><br>
        Deploy <code>FileAccessRegistry</code>:
        <pre style="margin:8px 0; background:#0b1220; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,.08); color:#d1d5db;">python deploy_contract.py</pre>
      </div>
      {% elif status.account_balance < 0.01 %}
      <div class="alert alert-warning">
        <strong>Low Account Balance</strong><br>
        Get test ETH from <a href="https://sepoliafaucet.com/" target="_blank" style="color:#93c5fd;">Sepolia Faucet</a>.
      </div>
      {% else %}
      <div class="alert alert-info">
        <strong>Blockchain Integration Ready</strong><br>
        Uploads and access changes will be logged on-chain.
      </div>
      {% endif %}

      <div class="actions">
        {% if status.available and status.connected and not status.contract_deployed %}
        <a href="#" onclick="alert('Run: python deploy_contract.py')" class="btn">Deploy Contract</a>
        {% endif %}

        {% if status.account_balance < 0.01 %}
        <a href="https://sepoliafaucet.com/" target="_blank" class="btn btn-warning">Get Test ETH</a>
        {% endif %}
      </div>
    </div>
  </div>
</body>
</html>
